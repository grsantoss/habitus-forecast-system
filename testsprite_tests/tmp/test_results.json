[
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "7f33f8a7-9d96-43c2-8899-106c99f391a1",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC001-post api auth login",
    "description": "Test user login with valid and invalid credentials and verify JWT token issuance.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nLOGIN_PATH = \"/api/auth/login\"\nTIMEOUT = 30\n\ndef test_post_api_auth_login():\n    url = BASE_URL + LOGIN_PATH\n    headers = {\"Content-Type\": \"application/json\"}\n\n    # Valid credentials from PRD default_credentials\n    valid_payload = {\n        \"email\": \"admin@habitus.com\",\n        \"password\": \"admin123\"\n    }\n\n    # Invalid credentials\n    invalid_payload = {\n        \"email\": \"invalid@habitus.com\",\n        \"password\": \"wrongpassword\"\n    }\n\n    # Test valid login\n    try:\n        resp_valid = requests.post(url, json=valid_payload, headers=headers, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Valid login request failed with exception: {e}\"\n\n    assert resp_valid.status_code == 200, f\"Expected 200 OK for valid login, got {resp_valid.status_code}\"\n    try:\n        json_valid = resp_valid.json()\n    except ValueError:\n        assert False, \"Response from valid login is not valid JSON\"\n\n    # Check for token under 'token' or 'access_token'\n    token_key = None\n    if \"token\" in json_valid:\n        token_key = \"token\"\n    elif \"access_token\" in json_valid:\n        token_key = \"access_token\"\n    else:\n        assert False, \"JWT token not found in valid login response\"\n\n    assert isinstance(json_valid[token_key], str) and len(json_valid[token_key]) > 0, \"Token is empty or not a string\"\n\n    # Test invalid login\n    try:\n        resp_invalid = requests.post(url, json=invalid_payload, headers=headers, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Invalid login request failed with exception: {e}\"\n\n    assert resp_invalid.status_code in {400, 401}, (\n        f\"Expected 400 or 401 status code for invalid login, got {resp_invalid.status_code}\"\n    )\n    try:\n        json_invalid = resp_invalid.json()\n    except ValueError:\n        assert False, \"Response from invalid login is not valid JSON\"\n\n    # Optional: Check if error message or code present indicating failure\n    assert (\n        \"error\" in json_invalid or \"message\" in json_invalid or \"detail\" in json_invalid\n    ), \"Invalid login response should contain error or message field\"\n\n\ntest_post_api_auth_login()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:42.999Z",
    "modified": "2025-12-09T17:52:22.400Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "6d74c3a9-c37d-46dd-8ffb-0677ba4ca2df",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC002-post api auth register",
    "description": "Test user registration with valid data and handle duplicate or invalid inputs.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:5000\"\nREGISTER_PATH = \"/api/auth/register\"\nTIMEOUT = 30\n\ndef test_post_api_auth_register():\n    url = BASE_URL + REGISTER_PATH\n    headers = {\"Content-Type\": \"application/json\"}\n\n    # Generate unique user data for testing valid registration\n    unique_email = f\"testuser_{uuid.uuid4()}@example.com\"\n    valid_payload = {\n        \"email\": unique_email,\n        \"password\": \"StrongPassw0rd!\"\n    }\n\n    # 1) Test successful registration with valid data\n    response = requests.post(url, json=valid_payload, headers=headers, timeout=TIMEOUT)\n    try:\n        assert response.status_code == 201, f\"Expected 201, got {response.status_code}\"\n        json_resp = response.json()\n        assert \"id\" in json_resp, \"Registration response missing user id\"\n    finally:\n        # Cleanup: attempt to delete the created user if possible (assuming admin endpoint or delete endpoint not specified, skip actual deletion)\n        pass\n\n    # 2) Test duplicate registration with the same email\n    response_dup = requests.post(url, json=valid_payload, headers=headers, timeout=TIMEOUT)\n    assert response_dup.status_code in (400, 409), f\"Expected 400 or 409 for duplicate registration, got {response_dup.status_code}\"\n\n    # 3) Test registration with invalid email\n    invalid_email_payload = {\n        \"email\": \"invalid-email-format\",\n        \"password\": \"StrongPassw0rd!\"\n    }\n    response_invalid_email = requests.post(url, json=invalid_email_payload, headers=headers, timeout=TIMEOUT)\n    assert response_invalid_email.status_code == 400, f\"Expected 400 for invalid email, got {response_invalid_email.status_code}\"\n\n    # 4) Test registration with missing password\n    missing_password_payload = {\n        \"email\": f\"{uuid.uuid4()}@example.com\"\n    }\n    response_missing_password = requests.post(url, json=missing_password_payload, headers=headers, timeout=TIMEOUT)\n    assert response_missing_password.status_code == 400, f\"Expected 400 for missing password, got {response_missing_password.status_code}\"\n\n    # 5) Test registration with weak password (assuming password policy)\n    weak_password_payload = {\n        \"email\": f\"{uuid.uuid4()}@example.com\",\n        \"password\": \"123\"\n    }\n    response_weak_password = requests.post(url, json=weak_password_payload, headers=headers, timeout=TIMEOUT)\n    assert response_weak_password.status_code == 400, f\"Expected 400 for weak password, got {response_weak_password.status_code}\"\n\ntest_post_api_auth_register()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 56, in <module>\n  File \"<string>\", line 22, in test_post_api_auth_register\nAssertionError: Expected 201, got 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.006Z",
    "modified": "2025-12-09T17:52:58.458Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "dbb7f6b4-2e08-46c9-ab2e-bbc0c2126e10",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC003-get api auth me",
    "description": "Test retrieval of current authenticated user data with valid JWT token.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nLOGIN_URL = f\"{BASE_URL}/api/auth/login\"\nME_URL = f\"{BASE_URL}/api/auth/me\"\nTIMEOUT = 30\n\ndef test_get_api_auth_me():\n    credentials = {\n        \"email\": \"admin@habitus.com\",\n        \"password\": \"admin123\"\n    }\n    try:\n        # Login to get JWT token\n        login_resp = requests.post(LOGIN_URL, json=credentials, timeout=TIMEOUT)\n        assert login_resp.status_code == 200, f\"Login failed: {login_resp.text}\"\n        login_data = login_resp.json()\n        # Check for token in login response\n        if \"token\" in login_data:\n            token = login_data[\"token\"]\n        elif \"access_token\" in login_data:\n            token = login_data[\"access_token\"]\n        else:\n            assert False, \"JWT token not found in login response\"\n\n        headers = {\n            \"Authorization\": f\"Bearer {token}\"\n        }\n\n        # Get authenticated user data\n        me_resp = requests.get(ME_URL, headers=headers, timeout=TIMEOUT)\n        assert me_resp.status_code == 200, f\"Failed to get authenticated user data: {me_resp.text}\"\n        me_data = me_resp.json()\n\n        # Validate that user data contains 'email'\n        assert isinstance(me_data, dict), \"User data response is not a JSON object\"\n        assert \"email\" in me_data, f\"Email not found in user data: {me_data}\"\n        assert me_data[\"email\"] == credentials[\"email\"], \"Returned email does not match login email\"\n\n    except requests.RequestException as e:\n        assert False, f\"Request failed with exception: {e}\"\n\ntest_get_api_auth_me()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 43, in <module>\n  File \"<string>\", line 37, in test_get_api_auth_me\nAssertionError: Email not found in user data: {'user': {'cargo': None, 'cnpj': None, 'created_at': '2025-11-21T14:21:57.690685', 'email': 'admin@habitus.com', 'empresa': None, 'id': 1, 'nome': 'Administrador', 'role': 'admin', 'status': 'active', 'telefone': None, 'updated_at': '2025-11-21T14:21:57.690685'}}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.012Z",
    "modified": "2025-12-09T17:52:38.853Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "a4819a58-cafa-4bae-b541-b9d76003bd6e",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC004-post api auth logout",
    "description": "Test user logout functionality and token invalidation.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nAUTH_BASE_PATH = \"/api/auth\"\nLOGIN_ENDPOINT = AUTH_BASE_PATH + \"/login\"\nLOGOUT_ENDPOINT = AUTH_BASE_PATH + \"/logout\"\n\nDEFAULT_EMAIL = \"admin@habitus.com\"\nDEFAULT_PASSWORD = \"admin123\"\n\ndef test_post_api_auth_logout():\n    try:\n        # 1. Login to get JWT token\n        login_payload = {\n            \"email\": DEFAULT_EMAIL,\n            \"password\": DEFAULT_PASSWORD\n        }\n        login_resp = requests.post(f\"{BASE_URL}{LOGIN_ENDPOINT}\", json=login_payload, timeout=30)\n        assert login_resp.status_code == 200, f\"Login failed with status {login_resp.status_code}\"\n        login_data = login_resp.json()\n        assert \"access_token\" in login_data, \"JWT token missing in login response\"\n        token = login_data[\"access_token\"]\n\n        headers = {\n            \"Authorization\": f\"Bearer {token}\"\n        }\n\n        # 2. Call logout endpoint\n        logout_resp = requests.post(f\"{BASE_URL}{LOGOUT_ENDPOINT}\", headers=headers, timeout=30)\n        assert logout_resp.status_code == 200, f\"Logout failed with status {logout_resp.status_code}\"\n\n        # 3. Verify token invalidation by calling /me endpoint (requires auth)\n        me_resp = requests.get(f\"{BASE_URL}{AUTH_BASE_PATH}/me\", headers=headers, timeout=30)\n        assert me_resp.status_code == 401 or me_resp.status_code == 403, \\\n            f\"Token not invalidated after logout, /me status: {me_resp.status_code}\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_post_api_auth_logout()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.019Z",
    "modified": "2025-12-09T17:52:20.322Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "7448e687-a21b-418b-bb55-eeabeabbeaa1",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC005-get api projetos",
    "description": "Test listing of projects for authenticated user.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nAUTH_URL = f\"{BASE_URL}/api/auth/login\"\nPROJECTS_URL = f\"{BASE_URL}/api/projetos\"\nDEFAULT_EMAIL = \"admin@habitus.com\"\nDEFAULT_PASSWORD = \"admin123\"\nTIMEOUT = 30\n\ndef test_get_api_projetos():\n    # Login to get JWT token\n    login_payload = {\n        \"email\": DEFAULT_EMAIL,\n        \"password\": DEFAULT_PASSWORD\n    }\n    try:\n        login_resp = requests.post(AUTH_URL, json=login_payload, timeout=TIMEOUT)\n        assert login_resp.status_code == 200, f\"Login failed with status {login_resp.status_code}\"\n        login_data = login_resp.json()\n        assert \"access_token\" in login_data, \"JWT token not found in login response\"\n        token = login_data[\"access_token\"]\n    except Exception as e:\n        raise AssertionError(f\"Login request failed: {e}\")\n\n    headers = {\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    try:\n        # Request to list projects\n        projects_resp = requests.get(PROJECTS_URL, headers=headers, timeout=TIMEOUT)\n        assert projects_resp.status_code == 200, f\"Expected 200 OK but got {projects_resp.status_code}\"\n        projects_data = projects_resp.json()\n        # Validate projects_data structure (expect a list or dict as returned)\n        assert isinstance(projects_data, (list, dict)), \"Projects response is not a list or dict\"\n    except Exception as e:\n        raise AssertionError(f\"Failed to get projects: {e}\")\n\ntest_get_api_projetos()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.025Z",
    "modified": "2025-12-09T17:52:15.667Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "d3973aec-d6bf-457a-a2d9-777af7586555",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC006-post api projetos",
    "description": "Test creation of new project with valid data for authenticated user.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nLOGIN_URL = f\"{BASE_URL}/api/auth/login\"\nPROJECTS_URL = f\"{BASE_URL}/api/projetos\"\nDEFAULT_EMAIL = \"admin@habitus.com\"\nDEFAULT_PASSWORD = \"admin123\"\nTIMEOUT = 30\n\ndef test_post_api_projetos():\n    # Authenticate user and get JWT token\n    login_payload = {\"email\": DEFAULT_EMAIL, \"password\": DEFAULT_PASSWORD}\n    try:\n        login_response = requests.post(LOGIN_URL, json=login_payload, timeout=TIMEOUT)\n        login_response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Login failed: {e}\"\n\n    login_json = login_response.json()\n    token = login_json.get(\"token\") or login_json.get(\"access_token\") or login_json.get(\"accessToken\")\n    assert token, \"JWT token not found in login response.\"\n\n    headers = {\n        \"Authorization\": f\"Bearer {token}\",\n        \"Content-Type\": \"application/json\"\n    }\n\n    # Prepare valid project data for creation\n    project_data = {\n        \"nome\": \"Projeto Teste\",\n        \"descricao\": \"Descrição do projeto de teste\",\n        \"cliente\": \"Cliente Teste\",\n        \"status\": \"ativo\"\n    }\n\n    created_project_id = None\n\n    try:\n        # Create new project\n        response = requests.post(PROJECTS_URL, json=project_data, headers=headers, timeout=TIMEOUT)\n        assert response.status_code == 201, f\"Expected status code 201 but got {response.status_code}\"\n        response_json = response.json()\n        assert isinstance(response_json, dict), f\"Response is not JSON object: {response_json}\"\n        # Assuming the created project returns an \"id\" field\n        created_project_id = response_json.get(\"id\")\n        assert created_project_id, \"Created project ID not found in response.\"\n        # Check returned fields match input at least partially\n        assert response_json.get(\"nome\") == project_data[\"nome\"], \"Project name mismatch.\"\n        assert response_json.get(\"descricao\") == project_data[\"descricao\"], \"Project description mismatch.\"\n\n    finally:\n        # Cleanup: delete created project if created_project_id is set\n        if created_project_id:\n            delete_url = f\"{PROJECTS_URL}/{created_project_id}\"\n            try:\n                del_response = requests.delete(delete_url, headers=headers, timeout=TIMEOUT)\n                # Accept 204 No Content or 200 OK on deletion\n                assert del_response.status_code in (200, 204), f\"Failed to delete project with id {created_project_id}\"\n            except requests.RequestException:\n                pass\n\n\ntest_post_api_projetos()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 63, in <module>\n  File \"<string>\", line 41, in test_post_api_projetos\nAssertionError: Expected status code 201 but got 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.031Z",
    "modified": "2025-12-09T17:52:47.158Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "029b257b-bd81-43c1-83e9-0994914b554a",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC007-post api upload planilha",
    "description": "Test upload and processing of valid Excel spreadsheet with authentication.",
    "code": "import requests\nimport io\n\nBASE_URL = \"http://localhost:5000\"\nLOGIN_URL = f\"{BASE_URL}/api/auth/login\"\nUPLOAD_URL = f\"{BASE_URL}/api/upload-planilha\"\nTIMEOUT = 30\n\ndef test_post_api_upload_planilha():\n    # Authenticate to get JWT token\n    auth_payload = {\n        \"email\": \"admin@habitus.com\",\n        \"password\": \"admin123\"\n    }\n    login_resp = requests.post(LOGIN_URL, json=auth_payload, timeout=TIMEOUT)\n    assert login_resp.status_code == 200, f\"Login failed: {login_resp.text}\"\n    login_data = login_resp.json()\n    token = login_data.get(\"access_token\") or login_data.get(\"token\") or login_data.get(\"jwt\")\n    assert token, \"JWT token not found in login response\"\n\n    headers = {\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Prepare a simple valid Excel file content in memory\n    # Excel file minimal content (xlsx) header bytes for empty file could be tricky, so make a small valid xlsx content.\n    # Here we create a simple Excel file using openpyxl for the upload without writing to disk.\n\n    try:\n        import openpyxl\n        from openpyxl import Workbook\n\n        wb = Workbook()\n        ws = wb.active\n        ws[\"A1\"] = \"Header1\"\n        ws[\"B1\"] = \"Header2\"\n        ws.append([123, 456])\n        excel_stream = io.BytesIO()\n        wb.save(excel_stream)\n        excel_stream.seek(0)\n    except ImportError:\n        # fallback dummy content if openpyxl not installed\n        # This won't be a valid xlsx but the test expects valid Excel spreadsheet so better raise error to install openpyxl.\n        raise RuntimeError(\"openpyxl is required for this test to create valid Excel file\")\n\n    files = {\n        \"file\": (\"test_planilha.xlsx\", excel_stream, \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\")\n    }\n\n    resp = requests.post(UPLOAD_URL, headers=headers, files=files, timeout=TIMEOUT)\n    assert resp.status_code == 200, f\"Upload failed: {resp.status_code} {resp.text}\"\n\n    resp_json = resp.json()\n    # Basic validation on response assuming JSON with success or processed info\n    assert isinstance(resp_json, dict), \"Response is not JSON dictionary\"\n    assert \"message\" in resp_json or \"success\" in resp_json or resp_json.get(\"status\") == \"ok\", f\"Unexpected response content: {resp_json}\"\n\ntest_post_api_upload_planilha()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"<string>\", line 30, in test_post_api_upload_planilha\nModuleNotFoundError: No module named 'openpyxl'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 58, in <module>\n  File \"<string>\", line 44, in test_post_api_upload_planilha\nRuntimeError: openpyxl is required for this test to create valid Excel file\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.037Z",
    "modified": "2025-12-09T17:52:30.355Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "6c6861b4-d518-452e-8940-8143e7e865d0",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC008-get api dashboard stats",
    "description": "Test retrieval of general financial statistics on dashboard with authentication.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nLOGIN_ENDPOINT = \"/api/auth/login\"\nDASHBOARD_STATS_ENDPOINT = \"/api/dashboard/stats\"\n\nHEADERS = {\"Content-Type\": \"application/json\"}\nTIMEOUT = 30\n\nDEFAULT_EMAIL = \"admin@habitus.com\"\nDEFAULT_PASSWORD = \"admin123\"\n\n\ndef test_get_api_dashboard_stats():\n    try:\n        # Step 1: Authenticate and obtain JWT token\n        login_payload = {\n            \"email\": DEFAULT_EMAIL,\n            \"password\": DEFAULT_PASSWORD\n        }\n        login_response = requests.post(\n            BASE_URL + LOGIN_ENDPOINT, \n            json=login_payload, \n            headers=HEADERS, \n            timeout=TIMEOUT\n        )\n        assert login_response.status_code == 200, \\\n            f\"Login failed with status code {login_response.status_code}: {login_response.text}\"\n        \n        login_data = login_response.json()\n        assert \"access_token\" in login_data, \"No access_token found in login response\"\n        token = login_data[\"access_token\"]\n\n        # Step 2: Use token to get dashboard stats\n        auth_headers = {\n            \"Authorization\": f\"Bearer {token}\"\n        }\n        dashboard_response = requests.get(\n            BASE_URL + DASHBOARD_STATS_ENDPOINT,\n            headers=auth_headers,\n            timeout=TIMEOUT\n        )\n        assert dashboard_response.status_code == 200, \\\n            f\"Dashboard stats retrieval failed: {dashboard_response.status_code} {dashboard_response.text}\"\n        \n        stats_data = dashboard_response.json()\n        assert isinstance(stats_data, dict), \"Dashboard stats response is not a JSON object\"\n        # Basic checks on likely keys (example)\n        # Since schema is not specified for dashboard stats, check that response is not empty\n        assert len(stats_data) > 0, \"Dashboard stats response is empty\"\n\n    except requests.exceptions.RequestException as e:\n        assert False, f\"Request failed: {str(e)}\"\n\n\ntest_get_api_dashboard_stats()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.043Z",
    "modified": "2025-12-09T17:52:53.562Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "80c5f53d-4404-45e6-99b4-717c61c2aae4",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC009-post api cenarios projetos projetoid cenarios",
    "description": "Test creation of financial scenario for a given project with valid data and authentication.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nAUTH_LOGIN_PATH = \"/api/auth/login\"\nPROJECTS_PATH = \"/api/projetos\"\nSCENARIOS_CREATE_PATH_TEMPLATE = \"/api/cenarios/projetos/{projeto_id}/cenarios\"\nTIMEOUT = 30\n\nDEFAULT_CREDENTIALS = {\n    \"email\": \"admin@habitus.com\",\n    \"password\": \"admin123\"\n}\n\ndef test_post_api_cenarios_projetos_projetoid_cenarios():\n    session = requests.Session()\n    token = None\n    project_id = None\n    scenario_id = None\n\n    try:\n        # Login to get JWT token\n        login_response = session.post(\n            BASE_URL + AUTH_LOGIN_PATH,\n            json=DEFAULT_CREDENTIALS,\n            timeout=TIMEOUT\n        )\n        assert login_response.status_code == 200, f\"Login failed, status code {login_response.status_code}\"\n        login_json = login_response.json()\n        token = login_json.get(\"token\") or login_json.get(\"access_token\")\n        assert token is not None, \"Token not found in login response\"\n\n        headers = {\n            \"Authorization\": f\"Bearer {token}\",\n            \"Content-Type\": \"application/json\"\n        }\n\n        # Create a new project to attach scenario to\n        project_payload = {\n            \"nome\": \"Test Project for Scenario\",\n            \"descricao\": \"Project created for testing scenario creation\"\n        }\n        project_response = session.post(\n            BASE_URL + PROJECTS_PATH,\n            json=project_payload,\n            headers=headers,\n            timeout=TIMEOUT\n        )\n        assert project_response.status_code == 201, f\"Project creation failed, status code {project_response.status_code}\"\n        project_json = project_response.json()\n        project_id = project_json.get(\"id\")\n        assert project_id is not None, \"Project ID not returned\"\n\n        # Create a financial scenario for the created project\n        scenario_payload = {\n            \"nome\": \"Scenario Test\",\n            \"descricao\": \"Scenario created during test\",\n            \"tipo\": \"Realista\",  # Assuming types like Pessimista, Realista, Otimista, Agressivo\n            \"percentual_variacao\": 5.0  # Example valid scenario data\n        }\n        create_scenario_path = SCENARIOS_CREATE_PATH_TEMPLATE.format(projeto_id=project_id)\n        scenario_response = session.post(\n            BASE_URL + create_scenario_path,\n            json=scenario_payload,\n            headers=headers,\n            timeout=TIMEOUT\n        )\n        assert scenario_response.status_code == 201, f\"Scenario creation failed, status code {scenario_response.status_code}\"\n        scenario_json = scenario_response.json()\n        scenario_id = scenario_json.get(\"id\")\n        assert scenario_id is not None, \"Scenario ID not returned\"\n        assert scenario_json.get(\"nome\") == scenario_payload[\"nome\"], \"Scenario name mismatch\"\n        assert scenario_json.get(\"tipo\") == scenario_payload[\"tipo\"], \"Scenario type mismatch\"\n\n    finally:\n        # Cleanup scenario\n        if token and scenario_id:\n            try:\n                session.delete(\n                    f\"{BASE_URL}/api/cenarios/{scenario_id}\",\n                    headers={\"Authorization\": f\"Bearer {token}\"},\n                    timeout=TIMEOUT\n                )\n            except Exception:\n                pass\n\n        # Cleanup project\n        if token and project_id:\n            try:\n                session.delete(\n                    f\"{BASE_URL}/api/projetos/{project_id}\",\n                    headers={\"Authorization\": f\"Bearer {token}\"},\n                    timeout=TIMEOUT\n                )\n            except Exception:\n                pass\n\ntest_post_api_cenarios_projetos_projetoid_cenarios()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 97, in <module>\n  File \"<string>\", line 48, in test_post_api_cenarios_projetos_projetoid_cenarios\nAssertionError: Project creation failed, status code 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.049Z",
    "modified": "2025-12-09T17:52:51.392Z"
  },
  {
    "projectId": "607e64be-2532-4c46-9db6-6410ac8e988f",
    "testId": "1611afeb-0e60-404f-a4c0-47544568b5de",
    "userId": "9428f448-e001-70ff-7a63-7d1459085a21",
    "title": "TC010-get api admin usuarios",
    "description": "Test listing of users by admin with proper authentication and admin role verification.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nLOGIN_URL = f\"{BASE_URL}/api/auth/login\"\nADMIN_USERS_URL = f\"{BASE_URL}/api/admin/usuarios\"\nTIMEOUT = 30\n\ndef test_get_api_admin_usuarios():\n    # Admin credentials from PRD default\n    admin_credentials = {\n        \"email\": \"admin@habitus.com\",\n        \"password\": \"admin123\"\n    }\n    try:\n        # Login as admin to get JWT token\n        login_resp = requests.post(LOGIN_URL, json=admin_credentials, timeout=TIMEOUT)\n        assert login_resp.status_code == 200, f\"Login failed with status {login_resp.status_code}\"\n        login_data = login_resp.json()\n        token = None\n        if \"token\" in login_data:\n            token = login_data[\"token\"]\n        elif \"access_token\" in login_data:\n            token = login_data[\"access_token\"]\n        else:\n            # If response has exactly one key and its value is string token\n            for v in login_data.values():\n                if isinstance(v, str):\n                    token = v\n                    break\n        assert token is not None, \"JWT token not found in login response\"\n        \n        headers = {\n            \"Authorization\": f\"Bearer {token}\"\n        }\n        \n        # Get list of admin users\n        users_resp = requests.get(ADMIN_USERS_URL, headers=headers, timeout=TIMEOUT)\n        assert users_resp.status_code == 200, f\"Failed to get admin users, status {users_resp.status_code}\"\n        users_data = users_resp.json()\n\n        # If users_data is dict and contains a list at some key, extract it, else assert is list\n        if isinstance(users_data, dict):\n            # Try common keys\n            if \"data\" in users_data and isinstance(users_data[\"data\"], list):\n                users_list = users_data[\"data\"]\n            elif \"users\" in users_data and isinstance(users_data[\"users\"], list):\n                users_list = users_data[\"users\"]\n            else:\n                # If dict does not have list under common keys, fail assertion\n                assert False, \"Admin users response dict does not contain user list under expected keys\"\n        elif isinstance(users_data, list):\n            users_list = users_data\n        else:\n            assert False, \"Admin users response is not a list or dict with user list\"\n\n        # Validate that the response list contains entries with required fields\n        if users_list:\n            first_user = users_list[0]\n            assert isinstance(first_user, dict), \"User entry is not a dictionary\"\n            assert \"email\" in first_user, \"User entry missing email\"\n            assert \"role\" in first_user, \"User entry missing role\"\n            assert isinstance(first_user.get(\"role\"), str), \"User role is not a string\"\n    except requests.RequestException as e:\n        assert False, f\"Request exception occurred: {e}\"\n\ntest_get_api_admin_usuarios()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 66, in <module>\n  File \"<string>\", line 50, in test_get_api_admin_usuarios\nAssertionError: Admin users response dict does not contain user list under expected keys\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-09T17:51:43.055Z",
    "modified": "2025-12-09T17:53:00.545Z"
  }
]
